package com.hykj.ccbrother.controller;

import com.github.pagehelper.PageInfo;
import com.hykj.ccbrother.base.AppBack;
import com.hykj.ccbrother.base.RequiresRole;
import com.hykj.ccbrother.model.ArticleClassModel;
import com.hykj.ccbrother.service.ArticleClassService;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import io.swagger.annotations.ApiParam;
import org.apache.log4j.Logger;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;

import java.util.HashMap;
import java.util.Map;

/**
 * 资讯分类
 *
 * @author innel
 * @email 2638086622@qq.com
 * @date 2017-11-06 16:09:39
 */
@Controller
@RequestMapping("/articleclass")
@Api(description = "资讯分类")
public class ArticleClassController {

    private Logger logger = Logger.getLogger(getClass());

    @Autowired
    private ArticleClassService articleClassService;

    /**
     * 列表
     */
    @RequestMapping("/list")
    @ResponseBody
    @RequiresRole(role = "1")
    @ApiOperation(
            value = "获取列表",
            notes = "备注：",
            httpMethod = "POST")
    public AppBack list(@ApiParam(value = "每页显示个数,不填默认10", required = false)
                        @RequestParam(required = false)
                                Integer pageSize,
                        @ApiParam(value = "", required = false)
                        @RequestParam(required = false)
                                Integer id,
                        @ApiParam(value = "0正常 -10删除", required = false)
                        @RequestParam(required = false)
                                Integer status,
                        @ApiParam(value = "开始时间 范例 2017-11-06 16:02:11", required = false)
                        @RequestParam(required = false)
                                String startTime,
                        @ApiParam(value = "截止时间 格式 YYYYMMDD 也可以", required = false)
                        @RequestParam(required = false)
                                String endTime,
                        @ApiParam(value = "不填不分页", required = false)
                        @RequestParam(required = false)
                                Integer page)

    {
        Map params = new HashMap();
        params.put("pageSize", pageSize);
        params.put("id", id);
        params.put("status", status);
        params.put("startTime", startTime);
        params.put("endTime", endTime);
        if (page == null) {
            return new AppBack(articleClassService.getList(params));
        }
        PageInfo<ArticleClassModel> p = articleClassService.getList(params, page);
        return new AppBack(p);
    }


    /**
     * 信息
     */
    @RequestMapping("/info")
    @ResponseBody
    @RequiresRole(role = "1")
    @ApiOperation(
            value = "获取当前资源",
            notes = "备注：",
            httpMethod = "POST")
    public AppBack info(@ApiParam(value = "当前资源的ID", required = true)
                        @RequestParam Integer id) {
        ArticleClassModel articleClass = articleClassService.getById(id);
        if (articleClass == null) {
            return new AppBack(-1, "当前资源不存在");
        }
        return new AppBack(articleClass);
    }

    /**
     * 保存
     */
    @RequestMapping("/save")
    @ResponseBody
    @RequiresRole(role = "1")
    @ApiOperation(
            value = "保存当前资源",
            notes = "备注：",
            httpMethod = "POST")
    public AppBack save(@ApiParam(value = "分类名", required = true)
                        @RequestParam(required = true)
                                String title,
                        @ApiParam(value = "选填参数控制 默认不填", required = false)
                        @RequestParam(required = false)
                                Integer extra) {
        ArticleClassModel articleClass = new ArticleClassModel();
        articleClass.setTitle(title);
        articleClass.setStatus(0);

        articleClassService.create(articleClass);
        return new AppBack();

    }

    /**
     * 修改
     */
    @RequestMapping("/update")
    @ResponseBody
    @RequiresRole(role = "1")
    @ApiOperation(
            value = "更新当前资源",
            notes = "备注：",
            httpMethod = "POST")
    public AppBack update(@ApiParam(value = "资源ID", required = true)
                          @RequestParam(required = true)

                                  Integer id,

                          @ApiParam(value = "分类名", required = false)
                          @RequestParam(required = false)

                                  String title,
                          @ApiParam(value = "0正常 -10删除", required = false)
                          @RequestParam(required = false)

                                  Integer status,
                          @ApiParam(value = "选填参数控制 默认不填", required = false)
                          @RequestParam(required = false)
                                  Integer extra) {
        ArticleClassModel articleClass = new ArticleClassModel();
        articleClass.setId(id);
        articleClass.setTitle(title);
        articleClass.setStatus(status);
        articleClassService.update(articleClass);
        return new AppBack();
    }

    /**
     * 删除
     */
    @RequestMapping("/delete")
    @ResponseBody
    @RequiresRole(role = "1")
    @ApiOperation(
            value = "删除当前资源",
            notes = "备注：",
            httpMethod = "POST")
    public AppBack delete(@ApiParam(value = "资源ID", required = true)
                          @RequestParam(required = true)
                                  int id) {

        ArticleClassModel newArticleClass = new ArticleClassModel();
        newArticleClass.setStatus(-10);
        newArticleClass.setId(id);
        articleClassService.update(newArticleClass);
        return new AppBack();
    }

}
